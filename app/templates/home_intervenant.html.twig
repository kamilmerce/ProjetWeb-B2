{% extends "base_auth.html.twig" %}

{% block body %}
<style>
body {
  font-family: 'Arial', sans-serif;
  background-image: url('/img/login.png'); 
  background-size: cover;
  background-repeat: no-repeat; 
  background-attachment: fixed; 
  background-position: center center; 
  display: flex;
  justify-content:center;
  align-items: center;
  color: white; 
  height: 100vh;
}

.liste-container {
  display: flex;
  flex-direction: column;
  margin-bottom:100px;
}

.en-tete {
  margin-top:150px;
  text-align:center;
  
}

.en-tete h1 {
  font-weight: bold;
  color:white;
  font-size:70px;
}

.en-tete select, input[type=text], button {
  width: 35%;
  height: 35%;
  padding: 10px;
  border: none;
  border-radius: 40px;
  background-color: #3A559F; 
  text-align: center;
  color: white;
  cursor: pointer;
  margin-top:0;
  margin-bottom:0;

}

.liste{
  background: rgba(255, 255, 255, 0.25);
  border-radius: 20px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  width: 300px; 
  height: 100px; 
  overflow-y: scroll; 
  border: 1px solid #ccc; 
  padding: 10px; 
  margin-bottom: 20px;
  scroll-snap-type: x mandatory;
  scrollbar-width: thin;
  scrollbar-color: white transparent;
  -ms-overflow-style: -ms-autohiding-scrollbar; /* Hide the scrollbar in IE and Edge */
}


.liste table  {
  border-collapse: separate; 
  border-spacing: 0; 
  border-radius: 20px;
  withd:100%;
  

}


.liste th, td {
  padding: 10px;
}

.liste td {
  border-bottom: 2px solid white; 
}

.table thead {
  width:100;
  background: rgba(255, 255, 255, 0.25);
  border-radius: 20px 20px 0 0; /* Apply border radius to the top corners only */
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.liste th {
  background-color: #3A559F;
  color:white;
  top:0px;
  position: sticky; 
  z-index: 1000; 
  vertical-align: top; 
}

.comment-content{
  border:none;
  
}

a {
  display: block;
  width: 100%;
  text-align: right;
  text-decoration: none;
  color: #3A559F;
}

@media (max-width: 1200px) {
  div {
    width: 450px;
  }
}

@media (max-width: 900px) {
  div {
    width: 100%;
  }
}
</style>
<body>
  {% if user.role == 'intervenant' %}
    <div class="liste-container">
      <div class="en-tete">
        <h1>Liste des interventions</h1>
        <form  classe ='form' action="search.php" method="GET">
          <select name="tri">
            <option value="id_intervention_asc">ID croissant</option>
            <option value="id_intervention_desc">ID décroissant</option>
            <option value="intervention_cloturee">Clôturée</option>
            <option value="intervention_annulee">Annulée</option>
            <option value="intervention_encours">En cours</option>
            <option value="intervention_enattente">En attente</option>
          </select>
          <button type="submit">Trier</button>
        </form>
      </div>
      <div class="liste" style="width: 1300px; height: 500px; overflow-y: scroll; border: 1px solid #ccc; padding: 10px; margin-bottom: 20px;">
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Date de début</th>
                    <th>Client</th>
                    <th>Standardiste</th>
                    <th>Infos</th>
                    <th>Commentaires</th>
                    <th>Status</th>
                    <th>Degré d'urgence</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
              {% for intervention in interventions %}
                {% if intervention.status_suivi != 'Clôturée' %}
                  <tr>
                    <td>{{ intervention.id }}</td>
                    <td>{{ intervention.start_date }}</td>
                    <td>{{ intervention.client_id }}</td>
                    <td>{{ intervention.standardiste_id }}</td>
                    <td>{{ intervention.infos }}</td>
                    <td>
                      <div class='comment-content' style="width: 300px; height: 100px; overflow-y: scroll; padding: 10px; margin-bottom: 20px;">
                        {% for commentaire in commentaires %}
                          {% if commentaire.intervention_id == intervention.id %}
                            <div class="comment">
                              <span class="comment-author">{{ commentaire.user_name }} {{ commentaire.user_surname }}</span>
                              <span class="comment-date">{{ commentaire.date_commentaire}}</span>
                              <p class="comment-content">{{ commentaire.commentaire}}</p>
                            </div>
                          {% endif %}
                        {% endfor %}
                      </div>
                    </td>
                    <td>{{ intervention.status_suivi }}</td>
                    <td>{{ intervention.degre_urgence }}</td>
                    <td><a href="edit_intervention.php?id={{ intervention.id }}">View more</a></td>
                  </tr>
                {% endif %}
              {% endfor %}
            </tbody>
        </table>
      </div>
    </div>
  {% endif %}
</body>
{% endblock %}
